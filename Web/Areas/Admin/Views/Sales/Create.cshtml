@model Web.Areas.Admin.Models.Sales.CreateSalesInvoiceViewModel

@section Header{
    @*<link href="~/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />*@
    <link href="~/assets/js/Select2ToTree/select2totree.css" rel="stylesheet" type="text/css" />
}

@*@TempData["alertNotification"]*@

@section Breadcrumb{
    <div class="page-title d-flex flex-column me-5 ms-lg-15">
        <!--begin::Title-->
        <h1 class=" text-dark fw-bolder fs-2 mb-0">
            <span class="badge badge-danger display-1 p-2">Invoice</span> #@Model.InvoiceId
        </h1>
        <ul class="breadcrumb breadcrumb-separatorless fw-bold fs-7 pt-1">
            <li class="breadcrumb-item text-muted">
                <a asp-action="Index" asp-controller="Home" class="text-muted text-hover-primary">
                    Home
                </a>
            </li>
            <li class="breadcrumb-item">
                <span class="bullet bg-gray-300 w-5px h-2px"></span>
            </li>
            <li class="breadcrumb-item text-muted">
                <a asp-action="Create" asp-controller="Sales" class="text-muted text-hover-primary">
                    Sales
                </a>
            </li>
        </ul>
    </div>
}
<form id="productForm" method="post" asp-action="create" asp-controller="Cashier" enctype="multipart/form-data" class="form d-flex flex-column flex-lg-row" data-kt-redirect="products.html">
    <!--begin::Aside column-->
    <div class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10">
        <!--begin::Thumbnail settings-->
        <div class="card card-flush py-4" style="background-color: blanchedalmond;">
			<div class="row g-5 mb-11">
				@*<div class="col-sm-6">
					#@(new Random().Next()) 
				</div>*@
				@*<div>
					<img onLoad="timeCount()" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" />
				</div>*@
				<div class="col-sm-12">
				<div id="clock"></div>
				</div>
			</div>
            <!--begin::Card header-->
            <div class="card-header">
                <!--begin::Card title-->
                <div class="card-title">
                    <h2>Total Price</h2>
                </div>
                <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body text-center pt-0">
               <h1 id="total_price">Total Price</h1>
			   <input asp-for="TotalPrice" class="form-control mb-2" hidden />
            </div>
            <!--end::Card body-->
        </div>
        <!--end::Thumbnail settings-->
        <!--begin::Category & tags-->
        <div class="card card-flush py-4">
            <!--begin::Card body-->
            <div class="card-body pt-0">
                <!--begin::Select2-->
                <label class="required form-label" asp-for="Tendered"></label>

                <input asp-for="Tendered" class="form-control mb-2" placeholder="Paid amoount...."/>
				<!--end::Select2-->
                <!--begin::Description-->
                <div class="text-muted fs-7">
                    <span asp-validation-for="Tendered" class="text-danger"></span>
                </div>
                <!--end::Description-->
				<!--begin::Input group-->
                <div class="mb-10 fv-row">
                    <!--begin::Label-->
                    <label class="required form-label" asp-for="Change"></label>
                    <!--end::Label-->
                    <!--begin::Input-->
                    <input asp-for="Change" class="form-control mb-2" placeholder="Change...." />
                    <!--end::Input-->
                    <!--begin::Description-->
                    <span asp-validation-for="Change" class="text-danger"></span>
                    <!--end::Description-->
                </div>
            </div>
           
        </div>
        <!--end::Category & tags-->
    </div>
    <!--end::Aside column-->
    <!--begin::Main column-->
    <div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">
        <!--begin:::Tabs-->
        <ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-bold mb-n2">
            <!--begin:::Tab item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary pb-4 active" data-bs-toggle="tab" href="#kt_ecommerce_add_product_english">Engilsh</a>
            </li>
            <!--end:::Tab item-->
        </ul>
        <!--end:::Tabs-->
        <!--begin::Tab content-->
        <div class="tab-content">
            <!--begin::Tab pane-->
            <div class="tab-pane fade show active" id="kt_ecommerce_add_product_english" role="tab-panel">
                <div class="d-flex flex-column gap-7 gap-lg-10">
                    <!--begin::General options-->
                    <!--begin::Card-->
							<div class="card card-flush">
								<!--begin::Card header-->
								<div class=" p-5">
									<div class="card-title">
										<!--begin::Search-->
										<div class="d-flex align-items-center position-relative my-1">
											<!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
											<span class="svg-icon svg-icon-1 position-absolute ms-6">
												<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
													<rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="black" />
													<path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z" fill="black" />
												</svg>
											</span>
											<!--end::Svg Icon-->
											<input type="text" data-kt-filemanager-table-filter="search" id="scanned-barcode" class="form-control form-control-solid ps-15" placeholder="Search Products &amp; Items" />
										</div>
										<!--end::Search-->
									</div>
									<!--begin::Card toolbar-->
									<div class="card-toolbar">
										<!--begin::Group actions-->
										<div class="d-flex justify-content-end align-items-center d-none" data-kt-filemanager-table-toolbar="selected">
											<div class="fw-bolder me-5">
											<span class="me-2" data-kt-filemanager-table-select="selected_count"></span>Selected</div>
											<button type="button" class="btn btn-danger" data-kt-filemanager-table-select="delete_selected">Delete Selected</button>
										</div>
										<!--end::Group actions-->
									</div>
									<!--end::Card toolbar-->
								</div>
								<!--end::Card header-->
								<!--begin::Card body-->
								<div class="card-body">
									<!--begin::Table header-->
									<div class="d-flex flex-stack">
										<!--begin::Folder path-->
										<div class="">
											
										</div>
										<!--end::Folder path-->
										<!--begin::Folder Stats-->
										<div class="badge badge-lg badge-primary">
											<span id="kt_file_manager_items_counter">66 items</span>
										</div>
										<!--end::Folder Stats-->
									</div>
									<!--end::Table header-->
									<!--begin::Table-->
                            <table class="table table-striped table-bordered dt-resposive nowrap AG-data-table"
                                   id="SalesInvoice"
                                   data-AG-columns='@Html.Raw(ViewBag.columns)'
                                   data-AG-message='@Html.Raw(ViewBag.Message)'
                                   data-AG-records='@Html.Raw(ViewBag.records_create)'
                                   data-AG-load-url='@Url.Action("Create_LoadDataTable","Cashier")'
                                   data-AG-edit='@Url.Action("Edit","Cashier")'
                                   data-AG-delete='@Url.Action("Delete","Cashier")'>
                                <thead>
                                    <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                        <th>ID</th>
                                        @foreach (var item in ViewBag.stringColumns)
                                        {
                                            <th>@item</th>
                                        }
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="fw-bold">
                                </tbody>
                                <tfoot>
                                    <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                        <th>ID</th>
                                        @foreach (var item in ViewBag.stringColumns)
                                        {
                                            <th>@item</th>
                                        }
                                        <th>Actions</th>
                                    </tr>
                                </tfoot>
                            </table>
									<!--end::Table-->
								</div>
								<!--end::Card body-->
							</div>
							<!--end::Card-->
                    <!--end::General options-->
                </div>
            </div>
            <!--end::Tab pane-->
        </div>
        <!--end::Tab content-->
        <div class="d-flex justify-content-end">
            <!--begin::Button-->
            <a asp-action="index" id="kt_ecommerce_add_product_cancel" class="btn btn-light me-5">Cancel</a>
            <!--end::Button-->
            <!--begin::Button-->
            <button type="submit" id="kt_ecommerce_add_product_submit" class="btn btn-primary">
                <span class="indicator-label">Save Changes</span>
                <span class="indicator-progress">
                    Please wait...
                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                </span>
            </button>
            <!--end::Button-->
        </div>
    </div>
    <!--end::Main column-->
</form>

<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<!--begin::Svg Icon | path: icons/duotune/arrows/arr066.svg-->
			<span class="svg-icon">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
					<rect opacity="0.5" x="13" y="6" width="13" height="2" rx="1" transform="rotate(90 13 6)" fill="black" />
					<path d="M12.5657 8.56569L16.75 12.75C17.1642 13.1642 17.8358 13.1642 18.25 12.75C18.6642 12.3358 18.6642 11.6642 18.25 11.25L12.7071 5.70711C12.3166 5.31658 11.6834 5.31658 11.2929 5.70711L5.75 11.25C5.33579 11.6642 5.33579 12.3358 5.75 12.75C6.16421 13.1642 6.83579 13.1642 7.25 12.75L11.4343 8.56569C11.7467 8.25327 12.2533 8.25327 12.5657 8.56569Z" fill="black" />
				</svg>
			</span>
			<!--end::Svg Icon-->
		</div>
		<!--end::Scrolltop-->

@section Scripts {
    <script>
        var idIncrementer = 1;

        $(document).ready(function () {
			timeCount();
            var tableCleared = true;
            var i = 0;
            _DataTable.Draw();
            $("#swalCall").on('click', function (event) {
                event.preventDefault();
                //if(loadData==null){
                var records = $('#SkuSubItem').attr("data-AG-records");
                if ($('#SkuSubItem').attr("data-AG-records") == 0 && tableCleared === true) {
                    $('#SkuSubItem').DataTable().clear().destroy();
                    //tableCleared = false;
                }

                var markup = `<tr role="row animate__animated animate__backInLeft" class="odd">
                                           <td>`+ idIncrementer + `</td>
                                           <td><input class="form-control form-control-sm text-start" id='scanned-barcode' type='text' name='ListSkuSubItems[`+ i + `].BarCodeNumber' placeholder='1234567890'></td>
                                           <td><input class="form-control form-control-sm text-start" type='number' id='subPrice' name='ListSkuSubItems[`+ i + `].Price' min='0' placeholder='0' style='width:100px;'></td>
                                           <td><input class="form-control form-control-sm text-start" type='text' name='ListSkuSubItems[`+ i + `].ExpiryDate' placeholder='2024-02-23' pattern="\d{1,2}/\d{1,2}/\d{4}" value=""></ td >
                                           <td class="text-end"><div class="badge badge-light-success">Published</div></td>
                                           <td><button onclick="removeEle(this)"; class="btn btn-icon btn-active-danger btn-outline btn-outline-default btn-icon-primary btn-active-icon-gray-700" ><i class="fa fa-trash" aria-hidden="true"></i></button></td>
                                           </tr>`;
                $("table tbody").append(markup);
                idIncrementer++;
                $(`[name='ListSkuSubItems[` + i + `].BarCodeNumber']`).focus();

                setTimeout(function () {
                    $(`[name='ListSkuSubItems[0].BarCodeNumber']`).attr("required", "required")
                    $(`[name='ListSkuSubItems[0].ExpiryDate']`).attr("required", "required")
                    $(`[name='ListSkuSubItems[0].Price']`).attr("required", "required")
                }, 500);

                tableCleared = false;
                i++;
                //<td><input class="form-control form-control-sm text-start" type='text' name='name' placeholder='Name' style='width:200px;'></td>

                //$(rowNode)
                //    .css('color', 'red')
                //    .animate({ color: 'black' });
            });
            //if i want to use id to remove element must use setTimeout to delay the creation of function before drawing element
            //or i could use callback function after drawing element which is better approach
            setTimeout(function () {
                $("#remove").on('click', function () {
                    $(this).closest('tr').remove();
                });
            }, 1000);
            setTimeout(function () {
                $("#scanned-barcode").on('change', function (event) {
					debugger;
                    event.preventDefault();
                    _Barcode.Scan();
					_AjaxCall.Call("10");
                document.querySelector('#total_price').innerText = $("#scanned-barcode").val();
                });
            }, 1000);

            $(`[name='Price`).on('keyup', function () {
                debugger;
                if ($(`[name='Price`).val() != "") {
                    //$('#subPrice').val($(`[name='Price`).val());
                    $('[id=subPrice]').each(function () {
                        $(this).val($(`[name='Price`).val());
                    })
                } else {
                    $('[id=subPrice]').each(function () { $(this).val(0) })
                }


            });

        });

        function removeEle(el) {
            $(el).closest('tr').remove();
            idIncrementer--;

        };

		function timeCount() {
		    var today = new Date();
		    var day = today.getDate();
		    var month = today.getMonth()+1;
		    var year = today.getFullYear();

		    var hour = today.getHours();
		    if(hour<10)hour = "0"+hour;

		    var minute = today.getMinutes();
		    if(minute<10)minute = "0"+minute;

		    var second = today.getSeconds();
		    if(second<10)second = "0"+second;

		    document.getElementById("clock").innerHTML = 
		    day+"/"+month+"/"+year+" |"+hour+":"+minute+":"+second;

		    setTimeout("timeCount()", 1000);
		};
                                                        //swall call was here
    </script>
    }

